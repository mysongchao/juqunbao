#!/bin/bash

# 紧急修复脚本 - 关闭健康检查，避免服务器卡死

echo "🚨 紧急修复：关闭健康检查以避免服务器卡死"
echo "=========================================="

# 1. 提交当前修改
echo "📝 提交代码修改..."
git add .
git commit -m "紧急修复：移除健康检查避免服务器卡死" || echo "提交失败，继续执行..."

# 2. 推送到远程仓库
echo "📤 推送到远程仓库..."
git push || echo "推送失败，请手动推送..."

# 3. 显示腾讯云控制台操作指南
echo ""
echo "🔧 请在腾讯云控制台执行以下操作："
echo "=========================================="
echo "1. 登录腾讯云控制台：https://console.cloud.tencent.com/"
echo "2. 进入云托管服务"
echo "3. 找到你的服务并点击进入"
echo "4. 点击'服务配置'或'设置'"
echo "5. 找到'健康检查'配置"
echo "6. 将'启用健康检查'设置为'关闭'"
echo "7. 保存配置"
echo "8. 点击'重新部署'"
echo "9. 选择最新代码版本"
echo "10. 等待部署完成"
echo ""
echo "📋 验证步骤："
echo "- 检查服务状态是否为'运行中'"
echo "- 确认没有健康检查错误"
echo "- 测试 API 访问：https://your-service-url/"
echo ""
echo "✅ 完成这些步骤后，健康检查将停止，服务器不再卡死"
echo ""
echo "📞 如果问题持续，请联系腾讯云技术支持：400-9100-1000" 