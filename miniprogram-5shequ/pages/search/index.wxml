<t-navbar title="搜索" left-arrow />
<view class="page search-page">
  <view class="search-input">
    <t-search
      t-class-input-container="t-class__input-container"
      t-class-input="t-search__input"
      value="{{searchValue}}"
      leftIcon="search"
      action="取消"
      shape="round"
      placeholder="请搜索你想要的内容"
      bind:submit="handleSubmit"
      bind:action-click="actionHandle"
      focus
      bind:input="onInput"
    ></t-search>
  </view>
  <view wx:if="{{searchResults.length > 0}}">
    <view class="search-results-title">搜索结果</view>
    <view class="search-results-list">
      <card
        wx:for="{{searchResults}}"
        wx:key="_id"
        url="{{item.url}}"
        desc="{{item.desc}}"
        tags="{{item.tags}}"
        bind:tap="goDetail"
        data-id="{{item._id}}"
        is-rich="true"
      />
    </view>
    <view wx:if="{{searchResults.length < searchTotal}}" class="search-loading">加载更多...</view>
  </view>
  <view class="search-no-result" wx:if="{{searchResults && searchResults.length === 0 && searchValue}}">
    <t-icon name="search" size="48rpx" />
    <text>未找到相关内容</text>
    <view class="recommend-title">为你推荐</view>
    <view class="search-results-list">
      <card
        wx:for="{{recommendList}}"
        wx:key="_id"
        url="{{item.url}}"
        desc="{{item.desc}}"
        tags="{{item.tags}}"
        bind:tap="goDetail"
        data-id="{{item._id}}"
      />
    </view>
  </view>
  <view class="search-wrap" wx:if="{{!searchResults || searchResults.length === 0}}">
    <view class="history-wrap">
      <view class="search-header">
        <text class="search-title">历史记录</text>
        <t-icon name="delete" size="large" class="search-clear" bind:click="handleClearHistory" />
      </view>
      <view class="search-content">
        <view
          class="search-item"
          hover-class="hover-history-item"
          wx:for="{{historyWords}}"
          bind:tap="handleHistoryTap"
          bindlongpress="deleteCurr"
          data-index="{{index}}"
          wx:key="*this"
        >
          <t-tag class="history-item margin-12" max-width="{{343}}" variant="light">{{item}}</t-tag>
        </view>
      </view>
    </view>
    <view class="popular-wrap">
      <view class="search-header">
        <text class="search-title">搜索发现</text>
      </view>
      <view class="search-content">
        <view
          class="search-item"
          hover-class="hover-history-item"
          wx:for="{{popularWords}}"
          bind:tap="handlePopularTap"
          data-index="{{index}}"
          wx:key="*this"
        >
          <t-tag class="popular-item margin-12" max-width="{{343}}" variant="light" icon="search"> {{item}} </t-tag>
        </view>
      </view>
    </view>
  </view>
  <t-dialog
    visible="{{dialogShow}}"
    content="{{dialog.message}}"
    bindconfirm="confirm"
    bind:close="close"
    confirm-btn="确定"
    cancel-btn="{{dialog.showCancelButton ? '取消' : null}}"
    t-class-confirm="dialog__button-confirm"
    t-class-cancel="dialog__button-cancel"
  />
</view>
