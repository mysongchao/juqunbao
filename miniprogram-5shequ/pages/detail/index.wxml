<view wx:if="{{loading}}">åŠ è½½ä¸­...</view>
<view wx:else>
  <view class="detail-container">
    <!-- å¤´éƒ¨ï¼šå¤´åƒã€æ˜µç§°ã€å…³æ³¨ -->
    <view class="detail-header">
      <image class="avatar" src="{{detail.author.avatar}}" />
      <text class="nickname">{{detail.author.nickname}}</text>
      <button class="follow-btn" bindtap="onFollowTap">{{detail.author.isFollowed ? 'å·²å…³æ³¨' : 'å…³æ³¨'}}</button>
    </view>
    <!-- å›¾ç‰‡åŒºï¼šå‰§ä¸­ï¼Œå®½åº¦70% -->
    <swiper class="detail-images" indicator-dots>
      <swiper-item wx:for="{{detail.images}}" wx:key="*this">
        <image class="main-image" src="{{item}}" mode="aspectFill" />
      </swiper-item>
    </swiper>
    <!-- æè¿°å†…å®¹ï¼Œå¾€ä¸‹ç§» -->
    <view class="detail-desc">{{detail.desc}}</view>
    <!-- æ ‡ç­¾åŒº -->
    <view class="detail-tags">
      <t-tag wx:for="{{detail.tags}}" wx:key="index">{{item}}</t-tag>
    </view>
    <!-- äº’åŠ¨åŒº -->
    <view class="detail-actions">
      <button bindtap="onLikeTap">{{detail.isLiked ? 'å·²èµ' : 'ç‚¹èµ'}} {{detail.likeCount}}</button>
      <button bindtap="onFavoriteTap">{{detail.isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}} {{detail.favoriteCount}}</button>
      <button bindtap="onCommentTap">è¯„è®º {{detail.commentCount}}</button>
      <text>æµè§ˆ {{detail.viewCount}}</text>
    </view>
    <!-- è¯„è®ºè¾“å…¥æ¡† -->
    <form bindsubmit="onSendComment" class="comment-form">
      <input name="comment" placeholder="{{replyTo ? 'å›å¤ ' + replyToUserName : 'è¯´ç‚¹ä»€ä¹ˆ...'}}"
             value="{{commentInput}}" bindinput="onCommentInput" focus="{{replyTo ? true : false}}" />
      <button formType="submit">å‘é€</button>
    </form>
    <!-- çƒ­è¯„ç½®é¡¶åŒº -->
    <view wx:if="{{hotComments.length}}" class="hot-comments">
      <view class="hot-title">çƒ­è¯„</view>
      <block wx:for="{{hotComments}}" wx:key="_id">
        <view class="comment-item hot">
          <text class="author">{{item.userName}}</text>
          <text wx:if="{{item.isAuthor}}" class="tag-author">æ¥¼ä¸»</text>
          <text wx:if="{{item.isAdmin}}" class="tag-admin">ç®¡ç†å‘˜</text>
          <text class="content">{{item.content}}</text>
          <text wx:if="{{item.replyToUserName}}" class="reply-to">@{{item.replyToUserName}}</text>
          <view class="actions">
            <text class="like" bindtap="onLikeComment" data-comment-id="{{item._id}}">ğŸ‘{{item.likeCount}}</text>
            <text class="reply" bindtap="onReplyComment" data-comment-id="{{item._id}}" data-user-name="{{item.userName}}">å›å¤</text>
            <text wx:if="{{item.canDelete}}" class="delete" bindtap="onDeleteComment" data-comment-id="{{item._id}}">åˆ é™¤</text>
          </view>
          <!-- æ¥¼ä¸­æ¥¼ -->
          <block wx:for="{{item.replies}}" wx:key="_id">
            <view class="reply-item">
              <text class="author">{{item.userName}}</text>
              <text wx:if="{{item.isAuthor}}" class="tag-author">æ¥¼ä¸»</text>
              <text wx:if="{{item.isAdmin}}" class="tag-admin">ç®¡ç†å‘˜</text>
              <text class="content">{{item.content}}</text>
              <text wx:if="{{item.replyToUserName}}" class="reply-to">@{{item.replyToUserName}}</text>
              <view class="actions">
                <text class="like" bindtap="onLikeComment" data-comment-id="{{item._id}}">ğŸ‘{{item.likeCount}}</text>
                <text class="reply" bindtap="onReplyComment" data-comment-id="{{item._id}}" data-user-name="{{item.userName}}">å›å¤</text>
                <text wx:if="{{item.canDelete}}" class="delete" bindtap="onDeleteComment" data-comment-id="{{item._id}}">åˆ é™¤</text>
              </view>
            </view>
          </block>
        </view>
      </block>
    </view>
    <!-- æ™®é€šè¯„è®ºåŒº -->
    <view wx:if="{{comments.length}}" class="comments">
      <block wx:for="{{comments}}" wx:key="_id">
        <view class="comment-item">
          <text class="author">{{item.userName}}</text>
          <text wx:if="{{item.isAuthor}}" class="tag-author">æ¥¼ä¸»</text>
          <text wx:if="{{item.isAdmin}}" class="tag-admin">ç®¡ç†å‘˜</text>
          <text class="content">{{item.content}}</text>
          <text wx:if="{{item.replyToUserName}}" class="reply-to">@{{item.replyToUserName}}</text>
          <view class="actions">
            <text class="like" bindtap="onLikeComment" data-comment-id="{{item._id}}">ğŸ‘{{item.likeCount}}</text>
            <text class="reply" bindtap="onReplyComment" data-comment-id="{{item._id}}" data-user-name="{{item.userName}}">å›å¤</text>
            <text wx:if="{{item.canDelete}}" class="delete" bindtap="onDeleteComment" data-comment-id="{{item._id}}">åˆ é™¤</text>
          </view>
          <!-- æ¥¼ä¸­æ¥¼ -->
          <block wx:for="{{item.replies}}" wx:key="_id">
            <view class="reply-item">
              <text class="author">{{item.userName}}</text>
              <text wx:if="{{item.isAuthor}}" class="tag-author">æ¥¼ä¸»</text>
              <text wx:if="{{item.isAdmin}}" class="tag-admin">ç®¡ç†å‘˜</text>
              <text class="content">{{item.content}}</text>
              <text wx:if="{{item.replyToUserName}}" class="reply-to">@{{item.replyToUserName}}</text>
              <view class="actions">
                <text class="like" bindtap="onLikeComment" data-comment-id="{{item._id}}">ğŸ‘{{item.likeCount}}</text>
                <text class="reply" bindtap="onReplyComment" data-comment-id="{{item._id}}" data-user-name="{{item.userName}}">å›å¤</text>
                <text wx:if="{{item.canDelete}}" class="delete" bindtap="onDeleteComment" data-comment-id="{{item._id}}">åˆ é™¤</text>
              </view>
            </view>
          </block>
        </view>
      </block>
    </view>
    <!-- ç©ºæ€æç¤ºä¿ç•™ -->
    <view wx:if="{{comments.length === 0 && !loadingComments}}" class="comment-empty">
      å¿«æ¥æŠ¢æ²™å‘å§~
    </view>
    <!-- è¯„è®ºåŒºã€ç›¸å…³æ¨èåç»­è¡¥å…… -->
  </view>
</view> 